---
title: "RapidFieldAssessments"
author: "VB"
date: "2024-09-17"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r load data, echo=FALSE}
library(readxl)
Soils <- read_excel("~/Downloads/Rapid Field Assessment Data (3).xlsx", 
    sheet = "Soils")
library(readxl)
Silvopasture <- read_excel("~/Downloads/Rapid Field Assessment Data (3).xlsx", 
    sheet = "Pasture")
library(readxl)
Vegetation <- read_excel("~/Downloads/Rapid Field Assessment Data (3).xlsx", 
    sheet = "Other Veg")
library(readxl)
Trees <- read_excel("~/Downloads/Rapid Field Assessment Data (3).xlsx", 
    sheet = "Trees")
```


```{r load liibraries, echo=FALSE}
library(tidyverse)
library(dplyr)
library(ggplot2)
library(wesanderson)
library(ggsci)
library(fgeo.analyze)
library(viridisLite)
library(RColorBrewer)
library(basictabler)
```

## Soil data pivot to create separate columns for each horizon depth and to 
##otherwise clean data
```{r soil change and pivot}
#cleaned_data <- Soils %>%
#  select(-Horizon_1, -Horizon_1_depth, -Horizon_2, -Horizon_2_depth, 
 #        -Horizon_3, - Horizon_3_depth)

reshaped_soils <- Soils %>%
  pivot_wider(names_from = horizon_number, 
              values_from = c(horizon_type, depth_cm),
              names_sep = "_horizon_")

soils_new <- reshaped_soils %>% 
  select(-depth_cm_horizon_ND, -depth_cm_horizon_NA, -horizon_type_horizon_NA, 
         -horizon_type_horizon_ND, -Sample_Notes)

soils_new_clean <- soils_new %>% 
  mutate(bare_soil_percent = as.numeric(replace(bare_soil_percent, bare_soil_percent == "ND", NA)))
```
## Soil summary stats: O horizon 
```{r soil summary stats}
## adjust to include plots that have no O horizon
##make boxplots of soil depth by horizon type
#o_horizon_data <- soils_new %>%
#  filter(horizon_type_horizon_1 == "O")
separate_depth_horizon <- function(soils_new_clean, depth_col) {
  soils_new_clean %>%
    separate(!!sym(depth_col), into = c(paste0(depth_col, "_start"), paste0(depth_col, "_end")), 
             sep = "-", convert = TRUE, fill = "right")
}

# Apply the function to each depth horizon column
soils_new_clean <- soils_new_clean %>%
  separate_depth_horizon("depth_cm_horizon_1") %>%
  separate_depth_horizon("depth_cm_horizon_2") %>%
  separate_depth_horizon("depth_cm_horizon_3")

#soils_final <- soils_new_clean %>%
#  separate(depth_cm_horizon_1, into = c("h1_depth_start", "h1_depth_end"), 
      #     sep = "-", convert = TRUE)
##replicate this for all horizons to split entire dataset by hyphen

soils_final %>%
  summarize(
    mean_depth_end = mean(h1_depth_end),
    median_depth_end = median(h1_depth_end),
    sd_depth_end = sd(h1_depth_end))
```
## Summary stats mulch, bare ground, CWD Soils data

```{r mulch, bare, CWD}
soils_new %>% 
  count(mulch_leaves_type)

soils_new %>% 
  count(CWD)

soils_new_clean %>% 
  summarize(avg_bare = mean(bare_soil_percent, na.rm = TRUE))
```

##Pasture summary stats plants in Quadrat
```{r pasture summary}
Silvopasture %>% 
  summarize(mean_legumes = mean(legumes_percent), 
            median_legumes = median(legumes_percent), 
            mean_grass = mean(grass_percent), 
            median_grass = median(grass_percent), 
            mean_other = mean(other_plants_percent), 
            median_other = median(other_plants_percent)) 
```
## Dot Density and Forage Quality Summary Stats
``` {r density and forage}
Silvopasture %>%   
  filter(dot_density != "NA") %>%
            summarize(mean_dots = mean(as.numeric(dot_density, na.rm = TRUE)), 
            median_dots = median(dot_density, na.rm = TRUE)) 

Silvopasture %>%   
  filter(forage_yield_in != "NA") %>%
            summarize(mean_yield = mean(as.numeric(forage_yield_in, na.rm = TRUE)), 
            median_yield = median(forage_yield_in, na.rm = TRUE))

```

## Silvopasture regression canopy coverage, bare, forage yield, etc. 
```{r pasture regression}
bare_soil_lm <- lm(bare_soil_percent ~ canopy_percent, data = Silvopasture)
summary(bare_soil_lm)


forage_height_lm <- lm(forage_yield_in ~ canopy_percent, data = Silvopasture)
summary(forage_height_lm)

#silvo_dot_reduced <- Silvopasture %>%
#  filter(as.numeric(dot_density))
#dot_density_lm <- lm(dot_density ~ canopy_percent, data = silvo_dot_reduced)
#summary(dot_density_lm)
```

## Other veg basic summary stats
```{r veg basic summary stats}
##number of distinct species
Vegetation %>%
  distinct(common_name) %>%
  nrow()

##avg percent cover by site
Vegetation %>%
  group_by(farm_name) %>%
  summarize(mean_percent_cover = mean(percent_cover, na.rm = TRUE))
## mean structure value 
Vegetation %>%
  group_by(farm_name) %>%
  summarize(mean_structure = mean(structure, na.rm = TRUE))
#Vegetation %>% 
 # group_by(farm_name) %>%
  #summarize(average_percent_cover = mean(percent_cover))
```
## Vegetation inquiry by functional Group

```{r other veg functional groups}
# Number of farms each of the ten most common species appears in 
Vegetation %>%
  group_by(common_name) %>%
  summarize(frequency = n_distinct(farm_name)) %>%
  arrange(desc(frequency)) %>% 
  slice(1:10)

#average number of species by system type
species_count <- Vegetation %>%
  group_by(system) %>%
  summarise(SpeciesCount = n_distinct(common_name))

species_count %>%
  group_by(system) %>%
  summarise(AverageSpecies = mean(SpeciesCount))

#number of species of each functional group type for each system
species_by_functional_group <- Vegetation %>%
  group_by(system, functional_group) %>%
  summarize(species_count = n_distinct(common_name))

ggplot(species_by_functional_group, aes(x = system, y = species_count, fill = functional_group)) +
  geom_bar(stat = "identity") +
  theme_minimal() +
  labs(title = "Number of Species by Functional Group for Each System",
       x = "System Type",
       y = "Number of Species",
       fill = "Functional Group") +
  scale_fill_manual(values = c("herbaceous" = "seagreen", 
                               "shrub/woody plant" = "burlywood2", 
                               "tree" = "sienna2")) + 
  theme(axis.text.x = element_text(angle = 45, hjust = 1))

```
## Basal area calculations for trees over 12.5cm 
```{r basal area long}
##This math is all wrong!!! Figure out why numbers are so freakin big? 
Plots <- Vegetation %>% 
  group_by(farm_name, site) %>% 
  distinct(plot) %>% 
  summarize(PlotCount = n())

tree_count <- Trees %>%  
  filter(DBH > 12.5) %>%
  group_by(farm_name, site) %>%           
  summarize(TreeCount = n()) 

trees_plots <- full_join(tree_count, Plots)
  
basal_area <- trees_plots %>% 
  mutate(basal_area = (TreeCount * 4.59)/PlotCount)
```
##Bar graphs of numbers of families present at each site
```{r bar graph families}
family_counts <- Vegetation %>% 
  filter(site != "Reference") %>%
  group_by(farm_name) %>%
  summarise(num_families = n_distinct(family))

ggplot(family_counts, aes(x = farm_name, 
                                            y = num_families,
                      fill = farm_name, width = 0.7)) +
  geom_bar(stat = "identity") +
  scale_fill_discrete() + 
  labs(title = "Number of Taxonomic Families Across Sites",
       x = "Site",
       y = "Number of Taxonomic Families") +
  theme_minimal() +
  theme(legend.position = "none",  # Remove the legend
        axis.text.x = element_text(angle = 45, hjust = 1),  # Rotate x-axis labels
        plot.title = element_text(hjust = 0.5)) +  # Center the plot title
  scale_x_discrete(labels = function(x) str_wrap(x, width = 25)) 
```
```{r boxplots}
boxplot(percent_cover ~ functional_group, data = Vegetation,
        main = "Distribution of Percent Cover by Vegetation Type",
        xlab = "Vegetation Type", ylab = "Percent Cover",
        col = "lightblue", border = "darkblue")

##boxplot of DBH by species for the 10 most common species in each system type

##Boxplot of percent cover by vegetation type

```
```{r silvopivot}
silvo_wide <- Silvopasture %>% 
  select(farm, site, plot, subplot, canopy_percent, legumes_percent, 
         grass_percent, dot_density, 
                    other_plants_percent, bare_soil_percent, 
                    mulch_leaves_per_cover, thatch_percent, forage_yield_in) %>%
  pivot_wider(
    names_from = subplot, 
    values_from = c(canopy_percent, legumes_percent, grass_percent, dot_density, 
                    other_plants_percent, bare_soil_percent, 
                    mulch_leaves_per_cover, thatch_percent, forage_yield_in), 
    names_glue = "{.value}_subplot_{subplot}" # This will rename the columns with subplot suffixes
  )
```

